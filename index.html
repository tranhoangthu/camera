<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Xem Camera Trực Tuyến</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
    }
    .camera-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 1rem;
      padding: 1rem;
    }
    .camera-frame {
      background-color: #f0f0f0;
      border-radius: 0.5rem;
      padding: 0.5rem;
      box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.1);
    }
    .camera-title {
      text-align: center;
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #333;
    }
    video {
      width: 100%;
      border-radius: 0.25rem;
      background-color: #000;
    }
    .no-video {
      background-color: #ddd;
      height: 180px;
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 0.25rem;
      color: #666;
      font-size: 0.8rem;
      text-align: center;
    }
  </style>
</head>
<body class="bg-gray-100">
  <h1 class="text-2xl font-semibold text-center text-gray-800 my-4">Xem Camera Trực Tuyến</h1>
  <div class="flex justify-center my-4">
    <button id="toggle-audio" class="px-4 py-2 bg-blue-500 hover:bg-blue-700 text-white rounded-md font-semibold">
      Bật Tất Cả Âm Thanh
    </button>
  </div>

  <div class="camera-container" id="cameraContainer"></div>

  <script>
    const videoSources = [
      { id: 'video-tphcm-1', title: 'TP.HCM 1', url: 'https://livevn.piepme.com/camhls/14789.a6a2cdaedb0e4a62b8307d232370f4ff_720p/index.m3u8' },
      { id: 'video-tphcm-2', title: 'TP.HCM 2', url: 'https://livevn.piepme.com/camhls/14789.1c9859765db1a5d224bc7b41fc8af740_720p/index.m3u8' },
      { id: 'video-danang-1', title: 'Đà Nẵng 1', url: 'https://livevn.piepme.com/camhls/14789.7341945e2076b7ec5463f16f515ec400_720p/index.m3u8' },
      { id: 'video-danang-2', title: 'Đà Nẵng 2', url: 'https://livevn.piepme.com/camhls/1b5aa79584634429877ce7beeb68ca3a_720p/index.m3u8' },
      { id: 'video-danang-3', title: 'Đà Nẵng 3', url: 'https://manifest.googlevideo.com/api/manifest/hls_variant/...index.m3u8' },
      { id: 'video-danang-4', title: 'Đà Nẵng 4', url: 'https://manifest.googlevideo.com/api/manifest/hls_variant/...index.m3u8' },
      { id: 'video-danang-5', title: 'Đà Nẵng 5', url: 'https://manifest.googlevideo.com/api/manifest/hls_variant/...index.m3u8' },
      { id: 'video-hoian', title: 'Hội An', url: 'https://livevn.piepme.com/camhls/14789.402a1e77e3ea1fcd2b2a36be6c2c4caa_720p/index.m3u8' },
    ];

    const container = document.getElementById('cameraContainer');
    let isMuted = true;

    // Render video elements dynamically
    videoSources.forEach(source => {
      const frame = document.createElement('div');
      frame.className = 'camera-frame';
      frame.innerHTML = `
        <h2 class="camera-title">${source.title}</h2>
        <video id="${source.id}" controls preload="none" muted class="video-player"></video>
      `;
      container.appendChild(frame);
    });

    const videoElements = document.querySelectorAll('video');

    // Load streams
    if (Hls.isSupported()) {
      videoSources.forEach(source => {
        const video = document.getElementById(source.id);
        if (!video) return;
        const hls = new Hls();
        hls.loadSource(source.url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => {
          video.play();
        });
        hls.on(Hls.Events.ERROR, (event, data) => {
          console.log('HLS error:', data);
          if (data.fatal) {
            if (data.type === Hls.ErrorTypes.NETWORK_ERROR) {
              hls.startLoad();
            } else if (data.type === Hls.ErrorTypes.MEDIA_ERROR) {
              hls.recoverMediaError();
            } else {
              hls.destroy();
              showError(video);
            }
          }
        });
      });
    } else {
      videoSources.forEach(source => {
        const video = document.getElementById(source.id);
        if (!video) return;
        if (video.canPlayType('application/vnd.apple.mpegurl')) {
          video.src = source.url;
          video.addEventListener('loadedmetadata', () => {
            video.play();
          });
          video.addEventListener('error', () => {
            showError(video);
          });
        }
      });
    }

    // Toggle mute
    document.getElementById('toggle-audio').addEventListener('click', () => {
      isMuted = !isMuted;
      videoElements.forEach(video => {
        video.muted = isMuted;
      });
      document.getElementById('toggle-audio').textContent = isMuted
        ? 'Bật Tất Cả Âm Thanh'
        : 'Tắt Tất Cả Âm Thanh';
    });

    function showError(video) {
      const wrapper = video.parentElement;
      video.remove();
      const errorDiv = document.createElement('div');
      errorDiv.className = 'no-video';
      errorDiv.innerText = 'Không thể phát video';
      wrapper.appendChild(errorDiv);
    }
  </script>
</body>
</html>
